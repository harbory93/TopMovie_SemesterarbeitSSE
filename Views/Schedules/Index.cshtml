@model IEnumerable<TopMovie_SemesterarbeitSSE.Models.Schedule>
@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Localization

@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
@inject IViewLocalizer Localizer
@inject IStringLocalizer<SharedResources> SharedLocalizer

@{
    ViewData["Title"] = @SharedLocalizer["Schedules"];
}

<h1>@SharedLocalizer["Schedules"]</h1>

@if (User.IsInRole("Admin"))
{
<p>
    <a asp-action="Create">@SharedLocalizer["Create New"]</a>
</p>
}
<table class="table">
    <thead>
        <tr>
            <th>
                @SharedLocalizer["ImagePath"]
            </th>
            <th>
                @SharedLocalizer["Time"]
            </th>
            <th>
                @SharedLocalizer["Date"]
            </th>
            <th>
                @SharedLocalizer["Movie"]
            </th>
            <th>
                @SharedLocalizer["Theater"]
            </th>
            <th>
                @SharedLocalizer["CapacityOpen"]
            </th>

            <th></th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
        <tr>
            <td>
                <a href="@item.Movie.ImagePath" target="_blank">
                    <img src="@item.Movie.ImagePath" style="max-width: 250px; max-height: 250px" />
                </a>
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Time)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Date)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Movie.Title)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Theater.Name)
            </td>
            <td>
                @((item.Theater.Capacity) - item.SeatsBooked)
            </td>
            <td>
                <form asp-controller="Schedules" asp-action="SelectSeats" method="post">
                    <input type="hidden" name="scheduleId" value="@item.Id" />
                    <input type="number" name="numberOfSeats" min="1" placeholder=@Localizer["Seats"] required/>
                    <button type="submit" class="btn btn-primary" style="margin-top: 5px; width: 120px;">@Localizer["Book Seats"]</button>
                </form>
            </td>
            <td>
                @await Html.PartialAsync("_CRUDPartial", item)
            </td>
        </tr>
    }
    </tbody>
</table>

<div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="feedbackModalLabel">@Localizer["Booking Feedback"]</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">@Localizer["Close"]</button>
            </div>
        </div>
    </div>
</div>

@if (TempData["MessageKey"] != null)
{
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            
            var localizedMessage = "@Html.Raw(@Localizer[TempData["MessageKey"].ToString()].Value)";

            var modalBody = document.querySelector('#feedbackModal .modal-body');
            modalBody.textContent = localizedMessage
            var feedbackModal = new bootstrap.Modal(document.getElementById('feedbackModal'));
            feedbackModal.show();
        });
    </script>
}